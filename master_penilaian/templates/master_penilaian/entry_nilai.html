{% extends 'base/horizontal/base.html' %}

{% load static %}

{% block css-extender %}
<style>
    #ranking-global thead th {
        background: white!important;
        position: sticky;
        top: 0;
      }
</style>        
{% endblock css-extender %}


{% block content %}
<!-- Start Content-->
<div class="container-fluid">

    <!-- start page title -->
    <div class="row">
        <div class="col-12">
            <div class="page-title-box">
                <h4 class="page-title">Dashboard</h4>
            </div>
        </div>
    </div>
    <!-- end page title -->

    <div class="row">
        <div class="col-xl-5 col-lg-6">

            <div class="row">
                <div class="col-lg-6">
                    <div class="card widget-flat">
                        <div class="card-body">
                            <div class="float-end">
                                <i class="mdi mdi-account-multiple widget-icon"></i>
                            </div>
                            <h5 class="text-muted fw-normal mt-0" title="Jumlah Kegiatan">Jumlah Kegiatan Diikuti</h5>
                            <h3 class="mt-3 mb-3">{{jml_kegiatan}}</h3>
                        </div> <!-- end card-body-->
                    </div> <!-- end card-->
                </div> <!-- end col-->

                <div class="col-lg-6">
                    <div class="card widget-flat">
                        <div class="card-body">
                            <div class="float-end">
                                <i class="mdi mdi-cart-plus widget-icon"></i>
                            </div>
                            <h5 class="text-muted fw-normal mt-0" title="Number of Orders">Jumlah Kegiatan Penilaian</h5>
                            <h3 class="mt-3 mb-3">{{jml_penilaian_aktif}}</h3>
                        </div> <!-- end card-body-->
                    </div> <!-- end card-->
                </div> <!-- end col-->
            </div> <!-- end row -->

            <div class="row">
                <div class="col-lg-6">
                    <div class="card widget-flat">
                        <div class="card-body">
                            <div class="float-end">
                                <i class="mdi mdi-currency-usd widget-icon"></i>
                            </div>
                            <h5 class="text-muted fw-normal mt-0" title="Average Revenue">Jumlah Mitra</h5>
                            <h3 class="mt-3 mb-3">{{jml_mitra_belum_dinilai}}</h3>
                        </div> <!-- end card-body-->
                    </div> <!-- end card-->
                </div> <!-- end col-->

                <div class="col-lg-6">
                    <div class="card widget-flat">
                        <div class="card-body">
                            <div class="float-end">
                                <i class="mdi mdi-pulse widget-icon"></i>
                            </div>
                            <h5 class="text-muted fw-normal mt-0" title="Growth">Jumlah Mitra Dinilai</h5>
                            <h3 class="mt-3 mb-3">{{jml_mitra_dinilai}}</h3>
                        </div> <!-- end card-body-->
                    </div> <!-- end card-->
                </div> <!-- end col-->
            </div> <!-- end row -->

        </div> <!-- end col -->

        <div class="col-xl-7 col-lg-6">
            <div class="card card-h-100">
                <div class="card-body">
                    <h4 class="header-title mb-3">Penilaian Mitra Global</h4>
                    <form class="d-flex mb-2">
                        <div class="input-group">
                            <input type="text" class="form-control form-control-light" placeholder="Cari Mitra" id="search-mitra">
                        </div>
                        <a href="javascript: void(0);" class="btn btn-primary ms-2" id="refresh-rank">
                            <i class="mdi mdi-autorenew"></i>
                        </a>
                    </form>
                    <div class="table-responsive" style="max-height: 250px; overflow-y: schroll; display:block">
                        <table class="table table-centered table-hover dt-responsive w-100" id="ranking-global">
                            <thead>
                                <tr>
                                    <th>Wilayah (Kecamatan)</th>
                                    <th>Nama Mitra</th>
                                    <th class="text-center">Rerata Nilai Akhir</th>
                                    <th>Ranking</th>
                                </tr>
                            </thead>
                            <tbody>
                               
                            </tbody>
                        </table>
                    </div> <!-- end table-responsive-->
                        
                </div> <!-- end card-body-->
            </div> <!-- end card-->

        </div> <!-- end col -->
    </div>
    <!-- end row -->
    <div class="row">
        <div class="col-xl-12">
            <div class="card">
                <div class="card-body">
                    <h4 class="header-title mt-2 mb-3">Kegiatan Penilaian Mitra</h4>
                    
                    <div class="table-responsive-sm">
                        <table class="table table-centered table-striped dt-responsive nowrap w-100" id="list_kegiatan_penilaian">
                            <thead>
                                <tr>
                                    <th>Nama Survei/Sensus</th>
                                    <th>Kegiatan Penilaian</th>
                                    <th>Tanggal Penilaian</th>
                                    <th>Status Kegiatan</th>
                                    <th>Status Penilaian Anda</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                              
                            </tbody>
                        </table>
                    </div>
                </div> <!-- end card-body-->
            </div> <!-- end card-->
        </div>
    </div>
    <!-- end row -->

    <div class="row">
        <div class="col-xl-12">
            <div class="card">
                <div class="card-body">
                    <h4 class="header-title mt-2 mb-3">Penilaian Mitra</h4>
                    <div class="input-group float-end">
                        <input type="text" class="form-control form-control-light" placeholder="Cari Data Mitra" id="search-mitra-datatable">
                    </div>
                    <input type="hidden" id="kegiatan_penilaian">
                    <div class="table-responsive-sm">
                        <table class="table table-centered table-striped dt-responsive nowrap w-100" id="list-penilaian">
                            <thead>
                                <tr>
                                    <th>Kegiatan Penilaian</th>
                                    <th>Wilayah</th>
                                    <th>Nama Mitra</th>
                                    <th>Role</th>
                                    <th>Rerata Nilai</th>
                                    <th>Status Penilaian Anda</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div> <!-- end card-body-->
            </div> <!-- end card-->
        </div>
    </div>

    <div class="row d-none" id="card-form-penilaian">
        <div class="col-xl-12">
            <div class="card">
                <div class="card-body">
                    <a href="javascript:void(0)" class="btn btn-sm btn-link float-end" id="close-card-form">Tutup</a>
                    <h4 class="header-title mt-2 mb-3">Input Penilaian Mitra</h4>

                    <form action="{% url 'master_penilaian:penilaian' %}" method="POST" id="formPenilaianPetugas">
                        {% csrf_token %}
                        <div class="row">
                            <p>Silahkan isikan Penilaian Petugas.</p>
                            <input type="hidden" name="id" id="id_id">
                            <div class="row mt-3">
                                <div class="col-6">
                                    <div class="row">
                                        <div class="col-sm-5">
                                            <h5 class="mb-3">Penilai</h5>
                                        </div>
                                        <div class="col-sm-7">
                                            <select class="form-select mb-2" id="field_id_penilai" name="field_id_penilai">
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-5">
                                            <h5 class="mb-3">Role Penilai</h5>
                                        </div>
                                        <div class="col-sm-7">
                                            <select class="form-select mb-2" id="field_role_penilai" name="field_role_penilai">
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-5">
                                            <h5 class="mb-3">Kegiatan Penilaian</h5>
                                        </div>
                                        <div class="col-sm-7">
                                            <select class="form-select mb-2 d-inline" id="field_kegiatan_penilaian" name="field_kegiatan_penilaian">
                                            </select>
                                        </div>
                                    </div>
                                    
                                </div>
                                <div class="col-6">
                                    <div class="row">
                                        <div class="col-sm-5">
                                            <h5 class="mb-3">Survei</h5>
                                        </div>
                                        <div class="col-sm-7">
                                            <select class="form-select mb-2" id="field_survey" name="field_survey">
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-5">
                                            <h5 class="mb-3">Petugas</h5>
                                        </div>
                                        <div class="col-sm-7">
                                            <select class="form-select mb-2 d-inline" id="field_mitra" name="field_mitra">
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-sm-5">
                                            <h5 class="mb-3">Role Petugas</h5>
                                        </div>
                                        <div class="col-sm-7">
                                            <select class="form-select mb-2 d-inline" id="field_role_petugas" name="field_role_petugas">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr>
                        </div>
                        <div class="table-responsive-sm mt-2 mb-3">
                            <table class="table table-centered table-striped dt-responsive nowrap w-100" id="table_form_penilaian">
                                <thead>
                                    <tr class="bg-info text-white">
                                        <th>No</th>
                                        <th>Indikator Penilaian</th>
                                        <th>Penilaian</th>
                                        <th>Catatan</th>
                                    </tr>
                                </thead>
                                <tbody>
                                
                                </tbody>
                            </table>
                        </div> <!-- end table-responsive-->
                        
                        <div class="row mt-3">
                            <div class="col-lg">        
                                <button type="submit" class="btn btn-primary" id="submitformPenilaianPetugas">Simpan Penilaian</button>
                            </div>
                        </div>
                    </form>

                </div> <!-- end card-body-->
            </div> <!-- end card-->
        </div>
    </div>
</div>
<!-- container -->
{% endblock content %}

{% block js-extender %}
<script src="{% static 'pages/js/entry_nilai.js' %}"></script>
<script>

    let table = generate_kegiatan_penilaian("{% url 'master_penilaian:list-penilaian-json' %}", "{{csrf_token}}")
    let table2 = generate_penilaian("{% url 'master_penilaian:list-nilai-json' %}", "{{csrf_token}}") 
    let table3 = generate_ranking_global("{% url 'master_penilaian:rank-petugas-json' %}", "{{csrf_token}}") 

    let entryPenilaian = (id1, id2) => entryPenilaianRequest("{% url 'master_penilaian:list-indicator-json' %}", "{{csrf_token}}", id1, id2)

    $('#formPenilaianPetugas').on('submit', (e) => {
        e.preventDefault()
        check_submit_penilaian("{{csrf_token}}")
    })

</script>
{% endblock js-extender %}